<html lang="en">
<head>
    <title>Pixel Garden</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <!-- Bootstrap core CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">

    <!-- Custom styles for this template -->
    <style>	
		
		body {
 			 /*background-image: url("Resources/Backgrounds/FrankLogo.png"); */
 			 background-color: #000000;
			}
		
		body, html {width: 100%; height: 100%; margin: 0; padding: 0}
				.row-container {display: flex; width: 100%; height: 100%; flex-direction: column; background-color: blue; overflow: hidden;}
				.first-row {background-color: lime; }
				.second-row { flex-grow: 1; border: none; margin: 0; padding: 0; }
		
      	
		.video_wrapper {
			position: relative;
			padding-bottom: 56.25%; /* 16:9, for an aspect ratio of 1:1 change to this value to 100% */ 
			}
			iframe{
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
		}
		
		
		.container {
            max-width: 1600px;
        }

    </style>
</head>
	
		
		
	
<body class="bg-black text-light" onload="Connect()" id="trigger">
	
    <!-- Main Content -->
    <div class="container">			
			
		<div class = "row">	
			<div class="col col-12">
				<div class="video_wrapper">
					<iframe src="https://player.twitch.tv/?channel=frankroomone&parent=frankwomencollective.github.io&muted=false" allowfullscreen class="second-row"  title="Living Room"></iframe>
				</div>
			</div>				
				
        </div>
        


        <div id="like_button_container"></div>


        <div id="zone_joystick"></div>
					
    </div>






    <!-- JavaScript
         ==================================================
         Placed at the end of the document so the pages load faster
         -->
    <!-- JQuery -->

    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <!-- JQuery UI -->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <!-- Bootstrap -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>

    <!-- Font Awesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/js/all.min.js"></script>

    <!-- MQTT Websockets Library -->
    <!--   Documentation: https://www.eclipse.org/paho/files/jsdoc/Paho.MQTT.Client.html -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>

    <!-- Additional Display Libraries -->
    <!-- <script src="https://unpkg.com/@popperjs/core@2"></script> -->


    <!-- Load React. -->
    <!-- Note: when deploying, replace "development.js" with "production.min.js". -->
    <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>

    <!-- Load our React component. -->
    <script src="LikeButton.js"></script>


    <script>
        // Bootstrap form submission prevention
        //   We want to use forms for display and function, NOT for submission.
        (function () {
            'use strict';
            window.addEventListener('load', function () {
                // Fetch all the forms we want to apply custom Bootstrap validation styles to
                var forms = document.getElementsByClassName('needs-validation');

                // Loop over them and prevent submission
                var validation = Array.prototype.filter.call(forms, function (form) {
                    form.addEventListener('submit', function (event) {
                        if (form.checkValidity() === false) {
                            return false;
                        }
                        event.preventDefault();
                        event.stopPropagation();
                        }, false);
                });
            }, false);
        })();
    </script>

    <script>
        // Helper functions

        /**
        * @return {string}
        */
        function makeid(length) {
            var result = '';
            var characters = 'abcdefghijklmnopqrstuvwxyz0123456789';
            var charactersLength = characters.length;
            for (var i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * charactersLength));
            }
            return result;
        }
        $("#clientid").attr("placeholder", makeid(8));

        /**
        * @see http://stackoverflow.com/q/7616461/940217
        * @return {number}
        */
        String.prototype.hashCode = function () {
            if (Array.prototype.reduce) {
                return this.split("").reduce(function (a, b) { a = ((a << 5) - a) + b.charCodeAt(0); return a & a }, 0);
            }
            var hash = 0;
            if (this.length === 0) return hash;
            for (var i = 0; i < this.length; i++) {
                var character = this.charCodeAt(i);
                hash = ((hash << 5) - hash) + character;
                hash = hash & hash; // Convert to 32bit integer
            }
            return hash;
        }
    </script>


    <script>
        // Initialization fuctions

        $('#connect').click(function () {
            $('#connect').removeClass('btn-success').addClass('btn-disabled');
            Connect();
            return false;
        });
        $('#disconnect').click(function () {
            Disconnect();
            return false;
        });
        $('#publish').click(function () {
            Publish()
            return false;
        });
        $('#subscribe').click(function () {
            Subscribe();
            return false;
        });
        $('#header-publish').on('click', function() {
            $('#panel-publish').slideToggle();
        })
        $('#header-subscribe').on('click', function() {
            $('#panel-subscribe').slideToggle();
        })
        $('#clear').click(function () {
            $('#subscriptions').empty();
        });
    </script>


    <script>
        // "Public" functions //
		
		//Unique ID for each USER//
		var userID = makeid(8);
		
		
        // Connect button press
        function Connect() {
			console.log("connect");
            var cleanSession = true;
            var useSSL = true;
            var endpoint = 'mqtt.frankuserinterface.live:8033';
            var username = "";
            var password = "";
            var clientid = "";

            uri = endpoint.split(/:/g);
            console.log("connecting to " + uri[0] + ":" + parseInt(uri[1]) + " using a " + (cleanSession ? "clean" : "persistant") + " session " + (username ? "with" : "without") + " authentication as " + clientid);

            $('#connection-status').removeClass('badge-disabled badge-success badge-danger badge-warning badge-primary badge-info badge-dark').addClass('badge-info');
            mqtt = new Paho.MQTT.Client(uri[0], parseInt(uri[1]), clientid);
            var options = {
                useSSL: useSSL,
                timeout: 3,
                cleanSession: cleanSession,
                onSuccess: onConnectionSuccess,
                onFailure: onConnectionFailure,

            };
            if (username != "")
                options.userName = username;
            if (password != "")
                options.password = password;

            mqtt.onConnectionLost = onConnectionLost;
            mqtt.onMessageArrived = onMessageArrived;
            mqtt.onMessageDelivered = onMessageSuccess;

            mqtt.connect(options);
        }

        // Disconnect button press
        function Disconnect() {
            mqtt.disconnect();
        }

        // Publish button press
        function Publish() {
			
            message = new Paho.MQTT.Message($('#publish-message').val());
			message.destinationName = $('#publish-topic').val();
            message.qos = parseInt($('#publish-qos').val());
            message.retained = $('#publish-retain').is(':checked');
            mqtt.send(message);
        }
		
		// Publish button press
        function PublishMessage(newMessage, newTopic) {
			console.log(userID);
            message = new Paho.MQTT.Message( userID + "/" + newMessage);
			message.destinationName = newTopic;
            message.qos = 0;
            message.retained = $('#publish-retain').is(':checked');
            mqtt.send(message);
        }

        // Subscribe button press
        function Subscribe() {
            mqtt.subscribe($('#subscribe-topic').val(), { qos: parseInt($('#subscribe-qos').val()), onSuccess: onSubscribeSuccess, onFailure: onSubscribeFailure });
        }
    </script>


    <script>
        // "Private" functions

        function onMessageSuccess(obj) {
            $("#feedback-publish").effect("highlight", {color: '#28a745'}, 3000);
            // $('#publish-message').addClass('is-valid');
        }
        function onSubscribeSuccess(obj) {
            $("#feedback-subscribe").effect("highlight", {color: '#28a745'}, 3000);
            // $('#subscribe-topic').addClass('is-valid');
        }
        function onSubscribeFailure(obj) {
            $('#subscribe-topic').addClass('is-invalid');
            $('#subscribe-error').html(obj.errorMessage);
        }
        function onConnectionSuccess(obj) {
            $('#connect').addClass('d-none');
            $('#disconnect').removeClass('d-none');
            $('#endpoint').attr('disabled', true);
            $('#use-ssl').attr('disabled', true);
            $('#username').attr('disabled', true);
            $('#password').attr('disabled', true);
            $('#clientid').attr('disabled', true);
            $('#clean-session').attr('disabled', true);
            $('#connect').removeClass('btn-disabled').addClass('btn-success');
            $('#publish').attr('disabled', false).removeClass('btn-secondary').addClass('btn-primary');
            $('#subscribe').attr('disabled', false).removeClass('btn-secondary').addClass('btn-primary');
            $('#connection-status').removeClass('badge-disabled badge-success badge-danger badge-warning badge-primary badge-info badge-dark').addClass('badge-success');

            mqtt.subscribe('test', { qos: 0 });
        }
        function onConnectionFailure(obj) {
            onConnectionLost(obj);
        }
        function onConnectionLost(obj) {
            if (obj.errorCode == 0) {
                $('#connection-status').removeClass('badge-disabled badge-success badge-danger badge-warning badge-primary badge-info badge-dark').addClass('badge-disabled');
            } else {
                $('#connection-status').removeClass('badge-disabled badge-success badge-danger badge-warning badge-primary badge-info badge-dark').addClass('badge-danger');
            }
            $('#disconnect').addClass('d-none');
            $('#connect').removeClass('d-none');
            $('#endpoint').attr('disabled', false);
            $('#use-ssl').attr('disabled', false);
            $('#username').attr('disabled', false);
            $('#password').attr('disabled', false);
            $('#clientid').attr('disabled', false);
            $('#clean-session').attr('disabled', false);
            $('#publish').attr('disabled', true).removeClass('btn-primary').addClass('btn-secondary');
            $('#subscribe').attr('disabled', true).removeClass('btn-primary').addClass('btn-secondary');
        }
        function onMessageArrived(obj) {
            $("#feedback-subscriptions").stop().css("background-color", "");  // Multiple messages could come in, reset element if still animating
            $("#feedback-subscriptions").effect("highlight", {color: '#28a745'}, 3000);
            if ($('#topic-' + obj.destinationName.hashCode()).length) {
                // Update
                $('#topic-' + obj.destinationName.hashCode()).effect("highlight");
                $('#message-' + obj.destinationName.hashCode()).html(obj.payloadString);
            } else {
                // Add
                $('#subscriptions').append("<li id='topic-" + obj.destinationName.hashCode() +
                    "' class='list-group-item justify-content-between lh-condensed'><div class='row text-light'><div class='col-md-9'>" +
                    obj.destinationName +
                    "</div><div class='col-md-3' id='message-" +
                    obj.destinationName.hashCode() +
                    "'>" +
                    obj.payloadString +
                    "</div></div></li>"
                )
            }
        }
    </script>

</body>
</html>
